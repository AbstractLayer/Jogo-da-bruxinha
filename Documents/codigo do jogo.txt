extends Node2D
class_name Cajado

# Importante a cena da particula
const PARTICLE: PackedScene = preload("res://Assets/Scenes/particle.tscn")

# Importantando os nodes para auxiliar a movimentação e animação do cajado.
@export_category("Nodes")
@export var cajado_node: Node2D = null
@export var cajado_sprite: Sprite2D = null

func _physics_process(delta):
	if Input.is_action_just_pressed("fire"):
		spawn_particle()
		#particle_animate()

func move_aim(attack_direction: Vector2, direction: Vector2) -> void:
	# esse if é para se caso for para esquerda ele rotacionar verticalmente o cajado
	# se não for esquerda, não rotaciona na direita.
	if attack_direction.x < 0:
		cajado_sprite.flip_v = true
	if attack_direction.x > 0:
		cajado_sprite.flip_v = false
	
	# esse if é para mudar a posição do cajado baseado onde o mouse esta sendo
	# direcionado, fazendo uma pespectiva melhor.
	if attack_direction.x < -0.75:
		cajado_sprite.offset = Vector2(26,0)
	elif attack_direction.x > 0.75:
		cajado_sprite.offset = Vector2(26,0)
	elif attack_direction.y < -0.75: 
		cajado_sprite.offset = Vector2(32,0)
	elif attack_direction.y > 0.75:
		cajado_sprite.offset = Vector2(32,0)
	# look_at para fazer o cajado olhar para onde a direção do mouse esta.
	look_at(direction)

func spawn_particle() -> void:
	var particle = PARTICLE.instantiate()
	particle.global_position = global_position
	get_tree().root.call_deferred("add_child", particle)

func particle_animate() -> void:
	pass
