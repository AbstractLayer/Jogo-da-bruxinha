extends CharacterBody2D
class_name Character

@onready var animation: AnimationPlayer = get_node("Animation")
@onready var animation_tree: AnimationTree = get_node("AnimationTree")
@onready var animation_mode = animation_tree.get("parameters/playback")
var speed: int

func _physics_process(_delta) -> void:
	commands()
	move()
	
func commands() -> void:
	if Input.get_action_strength("run"):
		speed = 275
	else:
		speed = 200
func move() -> void:
	var direction: Vector2 = Vector2(
		Input.get_axis("left", "right"),
		Input.get_axis("up", "down")
	).normalized()
	var mousePos: Vector2 = get_local_mouse_position().normalized()
	animation_tree.set("parameters/Idle/blend_position", mousePos)
	animation_tree.set("parameters/Walk/blend_position", mousePos)
	animation_tree.set("parameters/Walk_Reversed/blend_position", mousePos)
	animation_tree.set("parameters/Run/blend_position", mousePos)
	
	# Esse if funciona da seguinte forma: .dot é para fazer a conversão entre
	# 0 graus = -1, 90 graus = 0, 180 graus = 1
	# sign converte o Vector2 do MousePos(transforma qualquer float em -1,0,1
	# dependendo se o valor é negativo,positivo ou zero) para comparar com o dot
	# quando a direção do teclado e do mouse são iguais roda isso, se não
	# roda o else pois são diferentes
	
	if sign(mousePos.dot(direction)) >= 1:
		if direction != Vector2.ZERO:
			if Input.get_action_strength("run"):
				animation_mode.travel("Run")
			else:
				animation_mode.travel("Walk")
	elif direction != Vector2.ZERO:
		animation_mode.travel("Walk_Reversed")
		speed = 175
	else:
		animation_mode.travel("Idle")
	velocity = direction * speed
	move_and_slide()
	
